<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>SecuFill Calculator </title>
<meta name="theme-color" content="#07101d"/>
<style>
  :root{
    --bg:#07101d;
    --card:#0e1726;
    --border:#1f2a3a;
    --muted:#9fb0c3;
    --text:#e6edf3;
    --accent-secu:#c8f7d0; /* light green background for secufill badge */
    --accent-secu-ink:#06401a; /* dark ink on secufill badge */
    --accent-current:#9fb0c3; /* slate for current */
    --strip-h:100px;
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:860px;margin:0 auto;padding:16px;padding-bottom:calc(var(--strip-h) + env(safe-area-inset-bottom, 12px) + 18px)}

  .header{display:flex;justify-content:space-between;align-items:center;gap:10px}
  h1{font-size:1.05rem;margin:0;font-weight:800}
  .controls{display:flex;gap:8px}
  .btn{background:#0d1a25;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:10px;font-weight:700}
  .btn-primary{background:#22c55e;color:#052c17;border:none}

  /* cards container */
  .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}

  /* each scenario card */
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px}
  .card-title{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
  .title-left{display:flex;align-items:center;gap:12px}
  .badge{padding:.18rem .5rem;border-radius:999px;border:1px solid var(--border);font-weight:700;font-size:.78rem}
  .badge-current{color:var(--accent-current);border-color:var(--accent-current);background:transparent}
  .badge-secu{background:var(--accent-secu);color:var(--accent-secu-ink);border-color:var(--accent-secu)}

  /* visually highlight card left edge */
  .card.current{box-shadow:inset 6px 0 0 0 rgba(159,176,195,0.06)}
  .card.secu{box-shadow:inset 6px 0 0 0 rgba(200,247,208,0.06)}

  /* inputs layout */
  .fields{display:grid;grid-template-columns:1fr;gap:10px}
  .field{display:flex;flex-direction:column}
  label{font-size:.88rem;color:var(--muted);margin-bottom:6px}
  input[type=number]{padding:12px;border-radius:10px;border:1px solid var(--border);background:#07101d;color:var(--text);font-size:15px}
  input[type=number]::placeholder{color:#68727a}
  /* two-column layout on wider screens */
  @media (min-width:720px){
    .fields{grid-template-columns:repeat(2,1fr);gap:12px 16px}
    .field.full{grid-column:1/-1}
  }

  /* metrics row */
  .metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
  .metric{background:#07101d;border:1px solid var(--border);border-radius:10px;padding:10px;text-align:center}
  .m-k{font-size:.82rem;color:var(--muted)}
  .m-v{margin-top:6px;font-weight:800;font-size:1.02rem}

  /* bottom static strip */
  .strip{
    position:fixed;left:0;right:0;bottom:0;
    background:linear-gradient(180deg, rgba(7,16,29,0.0), rgba(7,16,29,0.95));
    border-top:1px solid var(--border);padding:10px 12px calc(10px + env(safe-area-inset-bottom,12px));
    display:flex;align-items:center;justify-content:center;z-index:30
  }
  .strip-inner{max-width:860px;width:100%;display:flex;gap:10px;align-items:center}
  .strip-box{flex:1;background:#07101d;border:1px solid var(--border);border-radius:10px;padding:10px;text-align:center}
  .strip-title{font-size:.82rem;color:var(--muted)}
  .strip-val{font-weight:800;margin-top:6px;font-size:1.04rem}
  .delta-pos{border-color:#0b5f34;box-shadow:0 0 0 3px rgba(34,197,94,0.06)}
  .delta-neg{border-color:#7f1d1d;box-shadow:0 0 0 3px rgba(239,68,68,0.06)}

  /* a little responsive niceness */
  @media (max-width:420px){
    .metrics{grid-template-columns:1fr;gap:8px}
  }

  /* print: show strip as static block */
  @media print{
    .strip{position:static;background:transparent;border:none;padding:0}
    .wrap{padding-bottom:0}
    .controls{display:none}
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="header">
    <h1>SecuFill Calculator </h1>
    <div class="controls">
      <button class="btn" id="reset">Reset</button>
      <button class="btn btn-primary" id="pdf">Download PDF</button>
    </div>
  </div>

  <div class="grid" id="grid">
    <!-- JS injects cards here -->
  </div>
</div>

<!-- bottom static strip: only per-patient numbers -->
<div class="strip" aria-hidden="false">
  <div class="strip-inner">
    <div class="strip-box" aria-label="Current practice per patient">
      <div class="strip-title">Current Practice</div>
      <div id="cur_pp" class="strip-val">—</div>
    </div>
    <div class="strip-box" aria-label="Using SecuFill per patient">
      <div class="strip-title">Using SecuFill</div>
      <div id="secu_pp" class="strip-val">—</div>
    </div>
    <div id="delta_box" class="strip-box" aria-label="Difference">
      <div class="strip-title">Difference (Current − SecuFill)</div>
      <div id="delta_pp" class="strip-val">—</div>
    </div>
  </div>
</div>

<script>
/* Model: two scenarios */
const scenarios = [
  { key: "B", title: "Current Practice", cls: "current", badge: "Current",
    fields: [
      ["B2","Number of Patients per day",30],
      ["B3","Cost of Syringe (₹)",1000],
      ["B4","Number of Days Syringe Re-used",1],
      ["B5","Cost of Y Tube (₹)",300],
      ["B6","Number of Y Tubes used per day",30],
      ["B7","Cost of 3 Way Connector (₹)",50],
      ["B8","Number of 3 Way Connector used per day",30],
      ["B9","Number of Working days",30]
    ]
  },
  { key: "C", title: "Using SecuFill", cls: "secu", badge: "SecuFill",
    fields: [
      ["C2","Number of Patients per day",30],
      ["C3","Cost of Syringe (₹)",1000],
      ["C4","Number of Days Syringe Re-used",1],
      ["C5","Cost of Y Tube (₹)",300],
      ["C6","Number of Y Tubes used per day",30],
      ["C7","Cost of SecuFill (₹)",200],
      ["C8","Number of SecuFill Used per day",30],
      ["C9","Number of Working days",30]
    ]
  }
];

function buildUI(){
  const grid = document.getElementById('grid');
  scenarios.forEach(s => {
    const card = document.createElement('section');
    card.className = 'card ' + s.cls;

    // title row
    const titleRow = document.createElement('div');
    titleRow.className = 'card-title';
    const left = document.createElement('div'); left.className = 'title-left';
    const h = document.createElement('div'); h.textContent = s.title; h.style.fontWeight = 800;
    const badge = document.createElement('div');
    badge.className = 'badge ' + (s.key === 'B' ? 'badge-current' : 'badge-secu');
    badge.textContent = s.badge;
    left.appendChild(h); left.appendChild(badge);
    titleRow.appendChild(left);
    card.appendChild(titleRow);

    // fields
    const fields = document.createElement('div'); fields.className = 'fields';
    s.fields.forEach(f => {
      const field = document.createElement('div'); field.className = 'field';
      if (f[0].endsWith('9')) field.classList.add('full'); // working days full width
      const lab = document.createElement('label'); lab.textContent = f[1];
      const inp = document.createElement('input'); inp.type = 'number'; inp.id = f[0]; inp.value = f[2];
      inp.min = 0; inp.inputMode = "numeric"; inp.autocomplete = "off";
      field.appendChild(lab); field.appendChild(inp); fields.appendChild(field);
    });
    card.appendChild(fields);

    // metric pills: Per patient, Per day, Per month
    const metrics = document.createElement('div'); metrics.className = 'metrics';
    metrics.innerHTML = `
      <div class="metric"><div class="m-k">Cost per patient</div><div id="pp_${s.key}" class="m-v">—</div></div>
      <div class="metric"><div class="m-k">Cost per day</div><div id="pd_${s.key}" class="m-v">—</div></div>
      <div class="metric"><div class="m-k">Cost per month</div><div id="pm_${s.key}" class="m-v">—</div></div>`;
    card.appendChild(metrics);

    grid.appendChild(card);
  });
}

function INR(n){
  try { return new Intl.NumberFormat('en-IN',{maximumFractionDigits:0}).format(Math.round(n)); }
  catch(e){ return Math.round(n).toString(); }
}
function V(id){
  const el = document.getElementById(id);
  if(!el) return 0;
  const v = Number(el.value);
  return Number.isFinite(v) ? v : 0;
}

/* Formulas (mirroring Excel)
 perDay = (cost_syringe / reuse_days) + (cost_ytube * y_per_day) + (cost_connector * connector_per_day)
 perPatient = perDay / patients_per_day
 perMonth = perDay * working_days
*/
function calc(prefix){
  const reuseDays = Math.max(1, V(prefix + '4'));
  const perDay = (V(prefix + '3') / reuseDays)
               + (V(prefix + '5') * V(prefix + '6'))
               + (V(prefix + '7') * V(prefix + '8'));
  const perPatient = V(prefix + '2') > 0 ? perDay / V(prefix + '2') : 0;
  const perMonth = perDay * V(prefix + '9');
  return { perDay, perPatient, perMonth };
}

function compute(){
  const B = calc('B');
  const C = calc('C');

  // update metric pills
  document.getElementById('pp_B').textContent = '₹' + INR(B.perPatient);
  document.getElementById('pd_B').textContent = '₹' + INR(B.perDay);
  document.getElementById('pm_B').textContent = '₹' + INR(B.perMonth);

  document.getElementById('pp_C').textContent = '₹' + INR(C.perPatient);
  document.getElementById('pd_C').textContent = '₹' + INR(C.perDay);
  document.getElementById('pm_C').textContent = '₹' + INR(C.perMonth);

  // bottom strip (only per-patient)
  document.getElementById('cur_pp').textContent = '₹' + INR(B.perPatient);
  document.getElementById('secu_pp').textContent = '₹' + INR(C.perPatient);

  // delta
  const D = B.perPatient - C.perPatient;
  const deltaBox = document.getElementById('delta_box');
  deltaBox.classList.remove('delta-pos','delta-neg');
  document.getElementById('delta_pp').textContent = (D >= 0 ? '▲ ' : '▼ ') + '₹' + INR(Math.abs(D));
  deltaBox.classList.add(D >= 0 ? 'delta-pos' : 'delta-neg');
}

/* wire up events */
function wire(){
  document.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('input', compute, {passive:true});
    inp.addEventListener('change', compute, {passive:true});
  });
  document.getElementById('reset').addEventListener('click', ()=>location.reload(), {passive:true});
  document.getElementById('pdf').addEventListener('click', ()=>window.print(), {passive:true});
  window.addEventListener('resize', compute, {passive:true});
  window.addEventListener('orientationchange', compute, {passive:true});
}

/* init */
buildUI();
wire();
compute();
</script>
</body>
</html>
